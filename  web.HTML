<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Yui AI</title>

<style>
/* ===== RESET & BASE STYLES ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background-color: #171717;
  color: #e5e5e5;
  line-height: 1.5;
  height: 100vh;
  overflow: hidden;
}

/* ===== APP CONTAINER ===== */
.app {
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: all 0.3s ease;
}

/* ===== EMPTY STATE ===== */
.app.empty {
  background-color: #171717;
}

.app.empty .chat-container {
  width: 420px;
  padding: 40px 30px;
  text-align: center;
  border-radius: 14px;
  background: #1e1e1e;
  box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
}

.title-big {
  font-size: 48px;
  font-weight: 700;
  margin-bottom: 20px;
  letter-spacing: 1px;
  color: #ffffff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

/* ===== ACTIVE CHAT STATE ===== */
.app.active {
  align-items: stretch;
  padding: 20px;
}

.app.active .chat-container {
  width: 100%;
  max-width: 900px;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: #171717;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* ===== CHAT AREA ===== */
.chat-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

#chat {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 16px;
  scroll-behavior: smooth;
}

/* Custom scrollbar for chat */
#chat::-webkit-scrollbar {
  width: 6px;
}

#chat::-webkit-scrollbar-track {
  background: #1a1a1a;
}

#chat::-webkit-scrollbar-thumb {
  background: #3c4b75;
  border-radius: 3px;
}

/* ===== MESSAGE BUBBLES ===== */
.bubble {
  max-width: 75%;
  padding: 12px 16px;
  border-radius: 16px;
  line-height: 1.5;
  word-wrap: break-word;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* User message */
.user {
  align-self: flex-end;
  background: linear-gradient(135deg, #3c4b75 0%, #2a3560 100%);
  color: #ffffff;
  border-bottom-right-radius: 4px;
}

/* AI message */
.ai {
  align-self: flex-start;
  background: #2f2f2f;
  color: #e5e5e5;
  border-bottom-left-radius: 4px;
}

/* Timestamp */
.time {
  font-size: 11px;
  opacity: 0.6;
  margin-top: 6px;
  text-align: right;
  font-weight: 300;
}

/* ===== TYPING INDICATOR ===== */
#typing {
  font-style: italic;
  opacity: 0.7;
  padding: 8px 24px;
  color: #a0a0a0;
  font-size: 14px;
  display: none;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 0.4; }
}

/* ===== INPUT BAR ===== */
.input-bar {
  padding: 20px;
  background: #1a1a1a;
  border-top: 1px solid #2a2a2a;
}

.input-box {
  display: flex;
  align-items: center;
  background: #2a2a2a;
  border-radius: 30px;
  padding: 8px 16px;
  border: 1px solid transparent;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.input-box:focus-within {
  border-color: #3c4b75;
  box-shadow: 0 0 0 2px rgba(60, 75, 117, 0.2);
}

.input-box input {
  flex: 1;
  background: transparent;
  border: none;
  outline: none;
  color: #ffffff;
  font-size: 15px;
  padding: 10px 12px;
  font-weight: 400;
}

.input-box input::placeholder {
  color: #888;
  font-weight: 300;
}

/* ===== BUTTONS ===== */
.icon-btn {
  background: none;
  border: none;
  color: #cccccc;
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
}

.icon-btn:hover {
  color: #ffffff;
  background: rgba(255, 255, 255, 0.1);
  transform: scale(1.05);
}

.icon-btn:active {
  transform: scale(0.95);
}

/* ===== RESPONSIVE CONSIDERATIONS ===== */
@media (max-width: 768px) {
  .app.active {
    padding: 10px;
  }
  
  .app.active .chat-container {
    max-width: 100%;
    border-radius: 8px;
  }
  
  .title-big {
    font-size: 36px;
  }
  
  .bubble {
    max-width: 85%;
  }
}

/* ===== UTILITY CLASSES ===== */
.hidden {
  display: none !important;
}

.fade-in {
  animation: fadeIn 0.5s ease;
}
</style>
</head>

<body>
<div class="app empty" id="app">
  <div class="chat-container">

    <div id="emptyView">
      <div class="title-big">YuiAI</div>
      <p>Yui Ai Cr: vall</p>
    </div>

    <!-- CHAT STATE -->
    <div id="chat"></div>
    <div id="typing">Yui sedang mengetik...</div>

    <div class="input-bar">
      <div class="input-box">
        <button class="icon-btn" title="Drawer">Ôºã</button>

        <input
          type="text"
          id="userInput"
          placeholder="Tulis pesan..."
          onkeydown="cekEnter(event)"
        >

        <button class="icon-btn" title="Clear Chat" onclick="clearChat()">üßπ</button>
        <button class="icon-btn" id="kirimBtn" title="Kirim" onclick="kirim()">‚èé</button>
      </div>
    </div>

  </div>
</div>

<script>
const app = document.getElementById("app");
const chat = document.getElementById("chat");
const typing = document.getElementById("typing");
let sessionId = localStorage.getItem("sessionId");

if (!sessionId) {
  sessionId = crypto.randomUUID();
  localStorage.setItem("sessionId", sessionId);
}


let aiSedangMengetik = false;
let chatData = JSON.parse(localStorage.getItem("chatData")) || [];

/* ====== UI MODE ====== */
function updateMode() {
  if (chatData.length === 0) {
    app.classList.add("empty");
    app.classList.remove("active");
  } else {
    app.classList.remove("empty");
    app.classList.add("active");
    document.getElementById("emptyView").style.display = "none";
  }
}

/* ====== CHAT BUBBLE ====== */
function tambahBubble(teks, tipe, simpan = true) {
  updateMode();

  const bubble = document.createElement("div");
  bubble.className = "bubble " + tipe;

  const message = document.createElement("div");
  message.innerText = teks;

  const time = document.createElement("div");
  const now = new Date();
  time.className = "time";
  time.innerText =
    now.getHours().toString().padStart(2, "0") + ":" +
    now.getMinutes().toString().padStart(2, "0");

  bubble.appendChild(message);
  bubble.appendChild(time);
  chat.appendChild(bubble);
  chat.scrollTo({
  top: chat.scrollHeight,
  behavior: "smooth"
});


  if (simpan) {
    chatData.push({ teks, tipe });
    localStorage.setItem("chatData", JSON.stringify(chatData));
  }
}

/* ====== SEND ====== */
function kirim() {
  if (aiSedangMengetik) return;

  const input = document.getElementById("userInput");
  const teks = input.value.trim();
  if (!teks) return;

  tambahBubble(teks, "user");
  input.value = "";

  typing.style.display = "block";
  aiSedangMengetik = true;

  fetch("http://localhost:3000/chat", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    message: teks,
    sessionId: sessionId
  })
})

  .then(res => res.json())
  .then(data => {
    typing.style.display = "none";
    tambahBubble(data.reply, "ai");
    aiSedangMengetik = false;
  })
  .catch(() => {
    typing.style.display = "none";
    tambahBubble("‚ö†Ô∏è Gagal hubungi Yui", "ai");
    aiSedangMengetik = false;
  });
}

/* ====== CLEAR ====== */
function clearChat() {
  chat.innerHTML = "";
  chatData = [];
  localStorage.removeItem("chatData");
  document.getElementById("emptyView").style.display = "block";
  updateMode();
}

/* ====== ENTER ====== */
function cekEnter(e) {
  if (e.key === "Enter") kirim();
}

/* ====== LOAD ====== */
window.onload = () => {
  chatData.forEach(item => tambahBubble(item.teks, item.tipe, false));
  updateMode();
};
</script>

</body>
</html>